<p style="color: green"><%= notice %></p>

<div id="page-wrapper">
  <div class="container-fluid">
    <div class="row">
      <div class="col-lg-12">
        <ol class="breadcrumb">
          <li class="active">
            <h1><i class="fas fa-box"></i> Meus Ativos</h1>
          </li>
        </ol>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid">
  <div class="row">
    <!-- Coluna da imagem -->
    <div class="col-md-3">
      <% if @item.image.attached? %>
        <%= image_tag @item.image, class: 'card-img-top rounded shadow-sm', alt: @item.name %>
      <% else %>
        <%= image_tag 'gestao_ativo1.jpg', class: 'card-img-top rounded shadow-sm', alt: 'Locker Padrão' %>
      <% end %>
    </div>

    <!-- Coluna dos detalhes -->
    <div class="col-md-9">
      <div class="card p-4 mb-4 shadow-sm">
      <h3 class="mb-3"><i class="fas fa-warehouse text-secondary me-2"></i> <%= @item.asset_management&.name%></h3>
        <ul class="list-group list-group-flush">
          <li class="list-group-item"><i class="fas fa-box text-secondary me-2"></i><strong>Nome:</strong> <%= @item.name %></li>
          <li class="list-group-item"><i class="fas fa-rss text-warning me-2"></i><strong>Tag RFID:</strong> <%= @item.tagRFID %></li>
          <li class="list-group-item"><i class="fas fa-hashtag text-info me-2"></i><strong>ID Interno:</strong> <%= @item.idInterno %></li>
          <li class="list-group-item"><i class="fas fa-align-left text-muted me-2"></i><strong>Descrição:</strong> <%= @item.description %></li>
          <li class="list-group-item"><i class="fas fa-list-alt text-primary me-2"></i><strong>Categoria:</strong> <%= @item.category&.name || "Sem categoria" %></li>
          <li class="list-group-item"><i class="fas fa-map-marker-alt text-success me-2"></i><strong>Localização:</strong> <%= @item.location&.name || "Sem localização" %></li>
          <li class="list-group-item">
            <i class="fas fa-info-circle text-dark me-2"></i><strong>Status:</strong>
            <button class="btn <%= @item.status == 'bloqueado' ? 'btn-danger' : 'btn-success' %> btn-sm">
              <i class="fas <%= @item.status == 'bloqueado' ? 'fa-lock' : 'fa-unlock' %>"></i> <%= @item.status %>
            </button>
          </li>
          <li class="list-group-item"><i class="fas fa-circle text-secondary me-2"></i><strong>Vazio:</strong> <%= @item.empty %></li>
          <li class="list-group-item"><i class="fas fa-calendar-plus text-info me-2"></i><strong>Criado em:</strong> <%= @item.created_at.strftime("%d/%m/%Y %H:%M") %></li>
          <li class="list-group-item"><i class="fas fa-edit text-warning me-2"></i><strong>Editado em:</strong> <%= @item.updated_at.strftime("%d/%m/%Y %H:%M") %></li>
        </ul>
      </div>

      <!-- Botões de ações -->
      <div class="d-flex gap-2 mb-4">
        <%= link_to edit_asset_management_item_path(@item.asset_management, @item), class: "btn btn-primary" do %>
          <i class="fas fa-edit"></i> Editar Ativo
        <% end %>

        <%= button_to @item, method: :delete, data: { confirm: "Tem certeza?" }, class: "btn btn-danger" do %>
          <i class="fas fa-trash-alt"></i> Excluir
        <% end %>

        <%= link_to asset_management_path(current_user.asset_managements.first), class: "btn btn-secondary" do %>
          <i class="fas fa-arrow-left"></i> Voltar
        <% end %>
      </div>

      <!-- Histórico do Item (últimas 5 movimentações) -->
      <div class="card shadow-sm mt-4">
        <div class="card-header bg-light">
          <h5 class="mb-0"><i class="fas fa-history me-2"></i> Últimas Movimentações</h5>
        </div>
        <div class="card-body">
          <% last_histories = @item.historic_managements.order(action_time: :desc).limit(5) %>

          <% if last_histories.any? %>
            <div class="row">
              <% last_histories.each do |h| %>
                <div class="col-12 col-md-6 mb-3">
                    <div class="card h-100 shadow-sm hover-card">
                      <div class="card-body">
                        <p class="mb-1"><i class="fas fa-user text-primary me-2"></i><strong>Usuário:</strong> <%= h.user.name %></p>
                        <p class="mb-1"><i class="fas fa-tasks text-success me-2"></i><strong>Ação:</strong> <%= h.action.capitalize %></p>
                        <% if h.description.present? %>
                          <p class="mb-1"><i class="fas fa-align-left text-muted me-2"></i><strong>Descrição:</strong> <%= truncate(h.description, length: 50) %></p>
                        <% end %>
                        <p class="mb-0 text-end text-muted"><i class="fas fa-clock me-1"></i><%= h.action_time.strftime("%d/%m/%Y %H:%M") %></p>
                      </div>
                    </div>
                </div>
              <% end %>
            </div>
            <div class="text-end mt-2">
              <%= link_to "Ver todo o histórico", asset_management_item_historic_managements_path(@item.asset_management, @item), class: "btn btn-primary btn-sm" %>
            </div>
          <% else %>
            <p class="text-muted"><i class="fas fa-info-circle me-2"></i> Nenhum histórico encontrado para este item.</p>
          <% end %>
        </div>
      </div>

    </div>
  </div>
</div>
