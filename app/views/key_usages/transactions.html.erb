<div id="page-wrapper">
  <div class="container-fluid">
    <div class="row align-items-center mb-3">
      <div class="col-lg-6">
        <h1>
          <i class="fas fa-exchange-alt"></i> Histórico de Movimentações
        </h1>
      </div>
      <div class="col-lg-6 text-right">
        <!-- Botões lado a lado -->
        <div class="btn-group" role="group" aria-label="Histórico Botões">
          <%= link_to entrada_key_usages_path, class: "btn btn-primary" do %>
            <i class="fas fa-list-alt"></i> Movimentações
          <% end %>

           <%= link_to key_usages_transactions_path, class: "btn btn-secondary" do %>
            <i class="fas fa-exchange-alt"></i> Transações
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>






<div class="row">
  <div class="col-lg-12">
    <div class="card shadow mb-4">
      <div class="card-body p-0">
        <table class="table table-bordered table-striped table-hover">
          <thead class="thead-dark">
            <tr>
                 <th><i class="fas fa-box-open text-primary"></i> Objeto</th>
                <th><i class="fas fa-map-marker-alt text-info"></i> Posição</th>
                <th><i class="fas fa-lock text-warning"></i> Serial Locker</th>
                <th><i class="fas fa-id-card text-secondary"></i> Tag RFID</th>
                <th><i class="fas fa-exchange-alt text-dark"></i> Movimentação</th>
                <th><i class="fas fa-user-check text-success"></i> Retirado por</th>
                <th><i class="fas fa-user-clock text-danger"></i> Devolvido por</th>
                <th><i class="fas fa-calendar-alt text-info"></i> Data / Hora</th>
                <th><i class="fas fa-check-circle text-primary"></i> Status</th>
            </tr>
          </thead>
          <tbody>
            <% (@transactions || []).each do |t| %>
              <% if t.keylockerinfo&.empty == 1 %>
                <% action_text = "Devolvido" %>
                <% badge_class = "badge-success" %>
              <% else %>
                <% action_text = "Entregue" %>
                <% badge_class = "badge-danger" %>
              <% end %>

              <% movement_description = "#{action_text} por #{t.giver&.name || 'N/A'} #{t.giver&.lastname || ''} para #{t.receiver&.name || 'N/A'} #{t.receiver&.lastname || ''}" %>

              <tr>
                <!-- Objeto -->
                <td>
                  <i class="fas fa-box-open text-primary"></i>
                  <strong><%= t.keylockerinfo&.object || 'N/A' %></strong>
                </td>

                <!-- Posição -->
                <td>
                  <i class="fas fa-map-marker-alt text-info"></i>
                  <strong><%= t.keylockerinfo&.posicion || 'N/A' %></strong>
                </td>

                <!-- Serial do locker -->
                <td>
                  <i class="fas fa-lock text-warning"></i>
                  <strong><%= t.keylocker&.serial || 'N/A' %></strong>
                </td>

                <!-- Tag RFID -->
                <td>
                  <i class="fas fa-id-card text-secondary"></i>
                  <strong><%= t.keylockerinfo&.tagRFID || 'N/A' %></strong>
                </td>

                <!-- Movimentação -->
                <td>
                  <i class="fas fa-exchange-alt text-dark"></i>
                  <%= movement_description %>
                </td>

                <!-- Retirado por -->
                <td>
                  <i class="fas fa-user-check text-success"></i>
                  <%= "#{t.giver&.name} #{t.giver&.lastname} (#{t.giver&.email})" %>
                </td>

                <!-- Devolvido por -->
                <td>
                  <i class="fas fa-user-clock text-danger"></i>
                  <%= "#{t.receiver&.name} #{t.receiver&.lastname} (#{t.receiver&.email})" %>
                </td>

                <!-- Data / Hora -->
                <td>
                  <i class="fas fa-calendar-alt text-info"></i>
                  <%= t.delivered_at&.strftime("%d/%m/%Y %H:%M") || 'N/A' %>
                </td>

                <!-- Status -->
                <td>
                  <i class="fas <%= t.keylockerinfo&.empty == 1 ? 'fa-undo text-success' : 'fa-check text-danger' %>"></i>
                  <span class="badge <%= badge_class %> p-2"><%= action_text %></span>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      <div class="card-footer d-flex justify-content-center">
        <%= will_paginate @transactions, renderer: BootstrapPagination::Rails %>
      </div>
    </div>
  </div>
</div>







